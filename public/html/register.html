<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ProducPlus - Cadastro</title>
    <link rel="shortcut icon" href="../assets/images/favicon/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="../assets/style/login.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100..900;1,100..900&display=swap"
        rel="stylesheet">
    <script src="../assets/js/config.js"></script>
</head>

<body>
    <header class="d-flex justify-content-center camada-nav">
        <div class="container container-navbar m-sm-0 p-sm-0 ">
            <nav class="navbar navbar-expand-lg">
                <div class="container-fluid ms-5 me-5 p-2">
                    <a class="navbar-brand m-0 " href="index.html" target="_self"><img
                            src="../assets/images/logo/LogoPequena.png"></a>
                    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                        aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
                        <ul class="navbar-nav gap-3 ">

                            <li class="nav-item">
                                <a class="nav-link" aria-current="page" href="contact.html" target="_parent">Contato</a>
                            </li>


                        </ul>
                    </div>
                </div>
            </nav>
        </div>

    </header>

    <main>
        <div class="main-content-login">

            <div class="block-hero-login">
                <img src="../assets/images/svg/register_hero_ProducPlus.svg" alt="">
            </div>

            <section class="section-content-login">
                <div class="section-content-img-login">
                </div>
                <div class="section-content-h1-login">
                    <h1> A <span style="color: #1714A8;">indústria</span> mais perto de você</h1>
                </div>
                <div class="content-size-login">
                    <div class="inputs-login">
                        <div class="wave-group">
                            <input required type="text" class="input" id="cnpjReg">
                            <span class="bar"></span>
                            <label class="label">
                                <span class="label-char" style="--index: 0">C</span>
                                <span class="label-char" style="--index: 1">N</span>
                                <span class="label-char" style="--index: 2">P</span>
                                <span class="label-char" style="--index: 3">J</span>
                            </label>
                        </div>

                        <div class="wave-group">
                            <input required type="text" class="input" id="nomeReg">
                            <span class="bar"></span>
                            <label class="label">
                                <span class="label-char" style="--index: 0">N</span>
                                <span class="label-char" style="--index: 1">o</span>
                                <span class="label-char" style="--index: 2">m</span>
                                <span class="label-char" style="--index: 3">e</span>
                            </label>
                        </div>

                        <div class="wave-group">
                            <input required type="email" class="input" id="emailReg">
                            <span class="bar"></span>
                            <label class="label">
                                <span class="label-char" style="--index: 0">E</span>
                                <span class="label-char" style="--index: 1">m</span>
                                <span class="label-char" style="--index: 2">a</span>
                                <span class="label-char" style="--index: 3">i</span>
                                <span class="label-char" style="--index: 4">l</span>
                            </label>
                        </div>

                        <div class="wave-group">
                            <input required type="text" class="input" id="telReg">
                            <span class="bar"></span>
                            <label class="label">
                                <span class="label-char" style="--index: 0">T</span>
                                <span class="label-char" style="--index: 1">e</span>
                                <span class="label-char" style="--index: 2">l</span>
                                <span class="label-char" style="--index: 3">e</span>
                                <span class="label-char" style="--index: 4">f</span>
                                <span class="label-char" style="--index: 5">o</span>
                                <span class="label-char" style="--index: 6">n</span>
                                <span class="label-char" style="--index: 7">e</span>
                            </label>
                        </div>

                        <div class="wave-group">
                            <input required type="text" class="input" id="endReg">
                            <span class="bar"></span>
                            <label class="label">
                                <span class="label-char" style="--index: 0">E</span>
                                <span class="label-char" style="--index: 1">n</span>
                                <span class="label-char" style="--index: 3">d</span>
                                <span class="label-char" style="--index: 4">e</span>
                                <span class="label-char" style="--index: 5">r</span>
                                <span class="label-char" style="--index: 6">e</span>
                                <span class="label-char" style="--index: 7">ç</span>
                                <span class="label-char" style="--index: 8">o</span>
                            </label>
                        </div>

                        <div class="wave-group">
                            <input required type="password" class="input" id="senhaReg">
                            <span class="bar"></span>
                            <label class="label">
                                <span class="label-char" style="--index: 0">S</span>
                                <span class="label-char" style="--index: 1">e</span>
                                <span class="label-char" style="--index: 2">n</span>
                                <span class="label-char" style="--index: 3">h</span>
                                <span class="label-char" style="--index: 4">a</span>
                            </label>
                        </div>

                        <a class="btn-action" href="#" id="btnRegistrar">
                            Criar conta
                        </a>

                        <h3>Já tem uma conta? <a href="login.html" target="_parent" style="color: #1714A8;">Faça
                                Login</a></h3>
                    </div>
                </div>


            </section>

        </div>

    </main>

    <footer>

    </footer>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
        crossorigin="anonymous"></script>
    <script src="https://unpkg.com/imask"></script>
    <script>
        const API_URL = window.API_URL;

        const cnpjInput = document.getElementById("cnpjReg");
        const cnpjMask = IMask(cnpjInput, {
            mask: '00.000.000/0000-00'
        });

        const telInput = document.getElementById("telReg");
        const telMask = IMask(telInput, {
            mask: [
                { mask: '(00) 0000-0000' },
                { mask: '(00) 00000-0000' }
            ]
        });

        document.getElementById('btnRegistrar').addEventListener('click', async (event) => {
            event.preventDefault();

            const cnpjFormatado = document.getElementById('cnpjReg').value;
            const telefoneFormatado = document.getElementById('telReg').value;
            const cnpjCliente = cnpjFormatado.replace(/\D/g, '');
            const telefone = telefoneFormatado.replace(/\D/g, '');
            const nome = document.getElementById('nomeReg').value;
            const email = document.getElementById('emailReg').value;
            const endereco = document.getElementById('endReg').value;
            const senha = document.getElementById('senhaReg').value;

            if (!cnpjCliente || !nome || !email || !senha || !telefone || !endereco) {
                alert("Por favor, preencha TODOS os campos.");
                return;
            }

            if (cnpjCliente.length !== 14) {
                alert("O CNPJ deve conter 14 números.");
                return;
            }

            if (email.endsWith('@producplus.com')) {
                alert("O domínio @producplus.com é reservado para a equipe administrativa.");
                return;
            }

            const dadosCliente = {
                cnpjCliente,
                nome,
                email,
                senha,
                telefone,
                endereco
            };

            try {
                const response = await fetch(`${API_URL}/auth/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(dadosCliente)
                });

                const data = await response.json();

                if (response.ok) {
                    alert("Conta criada com sucesso!");
                    window.location.href = 'login.html';
                } else {
                    // Mostra o erro real se houver
                    alert("Erro: " + (data.message || data.error));
                }
            } catch (error) {
                console.error(error);
                alert("Erro de conexão.");
            }
        });
    </script>
</body>

</html>